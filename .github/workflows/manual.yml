name: work place
on:
  issues:
    types: labeled
jobs:
  build:
#    runs-on: ubuntu-20.04
    runs-on: ubuntu-latest
#    runs-on: ubuntu-18.04
#    runs-on: ubuntu-16.04
    steps:
    - uses: actions/checkout@v2
      with:
       repository: ihsinme/OnionBase
       token: ${{ secrets.ACCESS_TOKEN }}
       ref: devTools
       path: devTools
    - name: "onion works"
      run: |
        sudo apt-get update 
        sudo apt-get install -y p7zip-full unzip iftop nmon
        sudo apt-get install -y tmate openssh-client python3-pip python3-setuptools python3-pandas
        sudo pip3 install pytelegrambotapi --upgrade
        echo 'net.ipv4.tcp_keepalive_time = 120'|sudo tee -a /etc/sysctl.conf 
        echo 'net.ipv4.tcp_keepalive_intvl = 30'|sudo tee -a /etc/sysctl.conf 
        echo 'net.ipv4.tcp_keepalive_probes = 8'|sudo tee -a /etc/sysctl.conf
        sudo sysctl -p
        sudo npm install --global http-server
        sudo mkdir /opt/docs/
        sudo mkdir /tmp/in
        sudo mkdir /tmp/out
        sudo mkdir /tmp/works
        sudo cp devTools/moduleIPYNB/in/RM.sh /opt/
        sudo cp devTools/moduleIPYNB/tele.py /opt/
        sudo cp devTools/moduleIPYNB/sshloc.sh /opt/
        echo -e 'y\n'|sudo ssh-keygen -q -t rsa -N "" -f /root/.ssh/id_rsa
        sudo cp devTools/moduleIPYNB/in/tmux.sh /opt/
    - name: "startsimpl"
      if: contains(github.event.label.name, 'startsimpl')      
      run: |
        sudo ifconfig
        sudo mkdir /opt/1
    - name: "jupyter"
      if: contains(github.event.label.name, 'jupyter')      
      run: |
        sudo cp devTools/moduleIPYNB/in/conf.py /opt/
        (sudo apt-get install python3-dev python3-pip python3-venv python3-wheel -y&& sudo pip3 install wheel)
        (sudo pip3 install jupyter_contrib_nbextensions && sudo jupyter contrib nbextension install)
        (sudo pip3 install scikit-learn&&sudo pip3 install xgboost&&sudo pip3 install kaggle --upgrade)
        (sudo pip3 install statsmodels&& sudo pip3 install seaborn&&sudo pip3 install graphviz&&sudo pip3 install bayesian-optimization)
        (sudo pip3 install plotly&&sudo pip3 install cufflinks)
        (sudo apt-get install -y python3-pydot python3-pydot-ng graphviz)
        sudo jupyter-notebook --config=/opt/conf.py &
    - name: "works"
      run:  sudo python3 devTools/moduleIPYNB/in/telebot/sl.py ${{github.event.label.name}}
    - name: "commit results works"
      run: |
        cd devTools
        sudo git config --local user.email "${GITHUB_ACTOR}@gmail.com"
        sudo git config --local user.name "${GITHUB_ACTOR}"
        sudo git remote -v
        sudo git add moduleIPYNB/
        sudo git commit -m "result ipynb works"
        sudo git push "https://ihsinme:${{ secrets.ACCESS_TOKEN }}@github.com/ihsinme/OnionBase.git" HEAD:devTools --force 
